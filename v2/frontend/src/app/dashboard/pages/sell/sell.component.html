<!-- Toast Notification -->
@if (notificationMessage()) {
<div class="toast toast-top toast-center z-50 animate-in">
  <div
    class="alert shadow-lg"
    [class.alert-success]="notificationType() === 'success'"
    [class.alert-warning]="notificationType() === 'warning'"
    [class.alert-error]="notificationType() === 'error'"
  >
    <span class="text-sm">{{ notificationMessage() }}</span>
  </div>
</div>
}

<!-- POS Container -->
<div class="container-app py-3 space-y-3 pb-20">
  <!-- Search Bar -->
  <app-product-search
    [searchResults]="searchResults()"
    [isSearching]="isSearching()"
    [isScannerActive]="isScannerActive()"
    [canStartScanner]="canStartScanner()"
    (searchTermChange)="handleSearchTermChange($event)"
    (productSelected)="handleProductSelected($event)"
    (scannerToggle)="handleScannerToggle()"
  />

  <!-- Scanner -->
  <app-product-scanner
    #scanner
    [channelId]="channelId()"
    [autoStartOnMobile]="false"
    (scannerReady)="handleScannerReady(scanner)"
    (scanningStateChange)="handleScanningStateChange($event)"
    (productDetected)="handleProductDetected($event)"
  />

  <!-- Empty State -->
  @if (!isScannerActive() && searchResults().length === 0) {
  <div class="text-center py-12">
    <div class="text-5xl mb-2">üîç</div>
    <p class="font-semibold">Ready to sell</p>
    <p class="text-sm opacity-60 mt-1">Search or scan products</p>
  </div>
  }
</div>

<!-- Cart FAB -->
@if (cartItems().length > 0) {
<button
  class="fixed bottom-20 right-4 btn btn-primary btn-circle shadow-xl z-40 w-14 h-14 sm:bottom-24 sm:right-6 sm:w-16 sm:h-16 transition-transform"
  [class.scale-110]="cartItemAdded()"
  (click)="openCartModal()"
  aria-label="View cart"
>
  <div class="indicator">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      class="h-6 w-6 sm:h-7 sm:w-7"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
      stroke-width="2.5"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"
      />
    </svg>
    <span
      class="indicator-item badge badge-secondary badge-sm font-bold transition-transform"
      [class.scale-125]="cartItemAdded()"
    >
      {{ cartItemCount() }}
    </span>
  </div>
</button>
}

<!-- Product Confirmation Modal -->
<app-product-confirm-modal
  [isOpen]="showConfirmModal()"
  [product]="detectedProduct()"
  (variantSelected)="handleVariantSelected($event)"
  (closeModal)="handleConfirmModalClose()"
/>

<!-- Cart Modal -->
<app-cart-modal
  [isOpen]="showCartModal()"
  [items]="cartItems()"
  [total]="cartTotal()"
  [showCashierFlow]="cashierFlowEnabled()"
  (quantityChange)="handleCartQuantityChange($event)"
  (removeItem)="handleCartItemRemove($event)"
  (checkoutCredit)="handleCheckoutCredit()"
  (checkoutCashier)="handleCheckoutCashier()"
  (checkoutCash)="handleCheckoutCash()"
  (closeModal)="handleCartModalClose()"
/>

<!-- Checkout Modal -->
<app-checkout-modal
  [isOpen]="showCheckoutModal()"
  [checkoutType]="checkoutType()"
  [itemCount]="cartItemCount()"
  [total]="cartTotal()"
  [error]="checkoutError()"
  [isProcessing]="isProcessingCheckout()"
  [selectedCustomer]="selectedCustomer()"
  [customerSearchResults]="customerSearchResults()"
  [isSearchingCustomers]="isSearchingCustomers()"
  [selectedPaymentMethod]="selectedPaymentMethod()"
  (completeCashier)="handleCompleteCashier()"
  (completeCredit)="handleCompleteCredit()"
  (completeCash)="handleCompleteCash()"
  (customerSearch)="handleCustomerSearch($event)"
  (customerSelect)="handleCustomerSelect($event)"
  (customerCreate)="handleCustomerCreate($event)"
  (paymentMethodSelect)="handlePaymentMethodSelect($event)"
  (closeModal)="handleCheckoutModalClose()"
/>
