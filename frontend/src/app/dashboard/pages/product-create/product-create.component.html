<!-- Product Creation - MEASURED vs DISCRETE Model -->
<div class="min-h-screen bg-base-200 p-4">
  <div class="max-w-2xl mx-auto space-y-4" [formGroup]="productForm">
    <!-- Header -->
    <div class="flex items-center justify-between">
      <h1 class="text-2xl font-bold">@if (isEditMode()) { Edit Product } @else { Add New Item }</h1>
      <button type="button" class="btn btn-ghost btn-sm" (click)="cancel()">Cancel</button>
    </div>

    <!-- Step 0: Item Type Selection -->
    <app-item-type-selector [itemType]="itemType()" (itemTypeChange)="setItemType($event)" />

    <!-- Step 1: Product Type (Only if itemType === 'product') -->
    <app-product-type-selector
      [itemType]="itemType()"
      [productType]="productType()"
      (productTypeChange)="setProductType($event)"
    />

    <!-- Step 2: Product Name -->
    <app-product-name-input [nameControl]="nameControl" />

    <!-- Step 3: Identification -->
    <app-identification-selector
      #identificationSelector
      [identificationMethod]="identificationMethod()"
      [barcodeControl]="barcodeControl"
      [photoCount]="photoCount()"
      [hasValidIdentification]="hasValidIdentification()"
      (methodChange)="chooseIdentificationMethod($event)"
      (barcodeScanned)="onBarcodeScanned($event)"
      (photosChanged)="onPhotosChanged($event)"
    />

    <!-- Step 4: Type-Specific Configuration -->
    @if (itemType() === 'product') {
    <!-- Measurement Unit Selector (for measured products) -->
    <app-measurement-unit-selector
      [measurementUnit]="measurementUnit()"
      [visible]="productType() === 'measured'"
      (unitChange)="setMeasurementUnit($event)"
    />

    <!-- Variant Dimension Editor -->
    <app-variant-dimension-editor
      [variantDimensions]="variantDimensions()"
      [productType]="productType()"
      (addDimension)="addVariantDimension()"
      (removeDimension)="removeVariantDimension($event)"
      (updateOptions)="updateDimensionOptions($event.id, $event.options)"
    />
    }

    <!-- Step 5: Generated SKUs Preview -->
    @if (itemType() === 'product') {
    <app-sku-list-editor [skus]="skus" [canRegenerate]="true" (regenerate)="generateSkus()" />
    }

    <!-- Step 6: Location -->
    @if (itemType() === 'product') {
    <app-location-display [location]="defaultLocation()" />
    }

    <!-- Service-specific form -->
    @if (itemType() === 'service') {
    <app-service-sku-editor [skuFormGroup]="firstSkuFormGroup" />
    }

    <!-- Validation Issues -->
    <app-validation-issues-panel [issues]="validationIssues()" />

    <!-- Submit Button -->
    <app-submit-bar
      [canSubmit]="canSubmit()"
      [isLoading]="isLoading()"
      [isEditMode]="isEditMode()"
      [itemType]="itemType()"
      [submitError]="submitError()"
      [submitSuccess]="submitSuccess()"
      (submit)="submitForm()"
    />
  </div>
</div>
