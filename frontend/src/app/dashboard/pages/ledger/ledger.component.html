<div class="space-y-5 lg:space-y-6">
  <!-- Header -->
  <div class="flex items-start justify-between gap-4">
    <div class="flex-1 min-w-0">
      <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold tracking-tight">Ledger</h1>
      <p class="text-base sm:text-lg text-base-content/60 mt-2 leading-relaxed">
        View accounts, transactions, and financial history
      </p>
    </div>

    <div class="flex gap-2 shrink-0">
      <button
        (click)="loadData()"
        class="btn btn-ghost btn-square btn-lg lg:btn-md"
        [class.loading]="isLoading()"
        title="Refresh ledger"
      >
        @if (!isLoading()) {
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6 lg:h-5 lg:w-5"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
            />
          </svg>
        }
      </button>
    </div>
  </div>

  <!-- Error Alert -->
  @if (error(); as err) {
    <div role="alert" class="alert alert-error shadow-lg">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-6 w-6 shrink-0"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"
        />
      </svg>
      <span class="flex-1">{{ err }}</span>
      <button (click)="error.set(null)" class="btn btn-sm">Dismiss</button>
    </div>
  }

  <!-- Summary Statistics Cards (visible in Overview and Transactions tabs) -->
  @if (activeTab() === 'overview' || activeTab() === 'transactions') {
    <app-ledger-stats [stats]="stats()" [formatCurrency]="formatCurrency" />
  }

  <!-- Filters Bar -->
  <app-ledger-filters
    [filters]="filters()"
    (searchTermChange)="onSearchTermChange($event)"
    (accountChange)="onAccountFilterChange($event)"
    (sourceTypeChange)="onSourceTypeFilterChange($event)"
    (dateFilterChange)="onDateFilterChange($event)"
    (quickFilterChange)="onQuickFilterChange($event)"
    (clearFilters)="clearFilters()"
  />

  <!-- Tabs -->
  <app-ledger-tabs [activeTab]="activeTab()" (tabChange)="setActiveTab($event)" />

  <!-- Tab Content -->
  <div class="mt-4">
    <!-- Overview Tab -->
    @if (activeTab() === 'overview') {
      <app-overview-tab
        [keyAccounts]="keyAccounts()"
        [recentEntries]="recentEntries()"
        [isLoading]="isLoading()"
        [selectedAccount]="selectedAccount()"
        [formatCurrency]="formatCurrency"
        [formatDate]="formatDate"
        [getEntryTotalDebit]="getEntryTotalDebit"
        [getEntryTotalCredit]="getEntryTotalCredit"
        (accountSelect)="selectAccount($event)"
        (entryView)="viewTransaction($event)"
      />
    }

    <!-- Accounts Tab -->
    @if (activeTab() === 'accounts') {
      <app-accounts-tab
        [accountsByType]="accountsByType()"
        [selectedAccount]="selectedAccount()"
        [formatCurrency]="formatCurrency"
        [getAccountTypeLabel]="getAccountTypeLabel"
        [getAccountTypeTotal]="getAccountTypeTotal"
        (accountSelect)="selectAccount($event)"
        (viewTransactions)="setActiveTab('transactions'); selectAccount($event)"
      />
    }

    <!-- Transactions Tab -->
    @if (activeTab() === 'transactions') {
      <app-transactions-tab
        [entries]="paginatedEntries()"
        [isLoading]="isLoading()"
        [expandedEntries]="expandedEntries()"
        [totalPages]="totalPages()"
        [currentPage]="currentPage()"
        [searchTerm]="searchTerm()"
        [selectedAccount]="selectedAccount()"
        [sourceTypeFilter]="sourceTypeFilter()"
        [dateFilter]="dateFilter()"
        [formatCurrency]="formatCurrency"
        [formatDate]="formatDate"
        [getEntryTotalDebit]="getEntryTotalDebit"
        [getEntryTotalCredit]="getEntryTotalCredit"
        (entryToggle)="toggleEntry($event)"
        (entryView)="viewTransaction($event)"
        (expandAll)="expandAll()"
        (collapseAll)="collapseAll()"
        (pageChange)="goToPage($event)"
        (clearFilters)="clearFilters()"
      />
    }

    <!-- Reconciliation Tab -->
    @if (activeTab() === 'reconciliation') {
      <app-reconciliation-tab
        [entries]="paginatedEntries()"
        [isLoading]="isLoading()"
        [totalPages]="totalPages()"
        [currentPage]="currentPage()"
        [formatDate]="formatDate"
        [formatDateTime]="formatDateTime"
        (entryView)="viewTransaction($event)"
        (pageChange)="goToPage($event)"
      />
    }
  </div>
</div>

<app-transaction-detail-modal
  #transactionModal
  [entry]="selectedEntry()"
  (closed)="closeTransactionModal()"
></app-transaction-detail-modal>
