<div class="min-h-screen bg-base-200">
  <!-- Navbar -->
  <nav class="bg-base-100 shadow-lg">
    <!-- Desktop Navbar -->
    <div class="navbar hidden lg:flex">
      <div class="flex-1 gap-4">
        <a class="btn btn-ghost text-xl normal-case">SimpleStock</a>
        @if (!loadingUser()) { @if (companies().length > 0) {
        <div class="flex items-center">
          <img
            [src]="generateURL(companies()[selectedCompanyIndex()], companies()[selectedCompanyIndex()].logo)"
            alt="Company Logo"
            class="h-8 w-8 mr-2 object-contain rounded-full"
          />
          <select
            class="select select-bordered select-sm w-48 max-w-xs"
            [(ngModel)]="selectedCompanyIndex"
            (change)="onCompanyChange()"
          >
            @for (company of companies(); track company.id; let i = $index) {
            <option class="max-w-xs" [ngValue]="i">
              {{company.name | truncate : 15}}
            </option>
            }
          </select>
        </div>
        } @else {
        <div class="badge badge-warning">No selected company</div>
        } @if(showDatePicker()) {
        <input
          type="date"
          [(ngModel)]="dateString"
          (ngModelChange)="updateDate($event)"
          class="input input-bordered input-sm"
        />
        } }
      </div>
      <div class="flex-none">
        <ul class="menu menu-horizontal p-0">
          <li>
            <a
              routerLink="/dashboard/transactions"
              [routerLinkActiveOptions]="{exact: true}"
              routerLinkActive="active"
              class="btn btn-ghost btn-sm"
              >Transactions</a
            >
          </li>
          <li>
            <a
              routerLink="/dashboard"
              [routerLinkActiveOptions]="{exact: true}"
              routerLinkActive="active"
              class="btn btn-ghost btn-sm"
              >Home</a
            >
          </li>
          <li>
            <a
              routerLink="/dashboard/config"
              [routerLinkActiveOptions]="{exact: true}"
              routerLinkActive="active"
              class="btn btn-ghost btn-sm"
              >Setup</a
            >
          </li>
        </ul>
      </div>
      <!-- User Menu -->
      <div class="dropdown dropdown-end">
        <label tabindex="0" class="btn btn-ghost btn-circle avatar">
          <div class="w-10 rounded-full">
            <img [src]="user?.avatarURL" alt="User Avatar" />
          </div>
        </label>
        <ul
          tabindex="0"
          class="mt-3 z-[1] p-2 shadow menu menu-sm dropdown-content bg-base-100 rounded-box w-52"
        >
          <li><a class="justify-between">Profile</a></li>
          <li><a>Settings</a></li>
          <li><a (click)="logout()">Logout</a></li>
        </ul>
      </div>
    </div>

    <!-- Mobile Navbar -->
    <div class="btm-nav lg:hidden">
      <a
        routerLink="/dashboard/transactions"
        routerLinkActive="active"
        [routerLinkActiveOptions]="{exact: true}"
        class="text-primary"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
          />
        </svg>
        <span class="btm-nav-label">Transactions</span>
      </a>
      <a
        routerLink="/dashboard"
        [routerLinkActiveOptions]="{exact: true}"
        routerLinkActive="active"
        class="text-primary"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
          />
        </svg>
        <span class="btm-nav-label">Home</span>
      </a>
      <a
        routerLink="/dashboard/config"
        routerLinkActive="active"
        [routerLinkActiveOptions]="{exact: true}"
        class="text-primary"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
          />
        </svg>
        <span class="btm-nav-label">Setup</span>
      </a>
    </div>
  </nav>

  <!-- Content -->
  <main class="container mx-auto p-4">
    @if (loadingUser()) {
    <div class="flex justify-center items-center h-screen">
      <span class="loading loading-spinner loading-lg"></span>
    </div>
    } @else {
    <!-- Top Bar (Mobile) -->
    <header class="lg:hidden mb-4">
      <div class="flex justify-between items-center">
        @if (companies().length > 0) {
        <div class="flex items-center space-x-2">
          <img
            [src]="generateURL(companies()[selectedCompanyIndex()], companies()[selectedCompanyIndex()].logo)"
            alt="Company Logo"
            class="h-8 w-8 object-contain rounded-full"
          />
          <select
            class="select select-bordered select-sm w-40 max-w-xs"
            [(ngModel)]="selectedCompanyIndex"
            (change)="onCompanyChange()"
          >
            @for (company of companies(); track company.id; let i = $index) {
            <option class="max-w-xs" [ngValue]="i">
              {{company.name | truncate : 10}}
            </option>
            }
          </select>
        </div>
        } @else {
        <div class="badge badge-warning">No selected company</div>
        } @if(showDatePicker()) {
        <input
          type="date"
          [(ngModel)]="dateString"
          (ngModelChange)="updateDate($event)"
          class="input input-bordered input-sm"
        />
        }

        <div class="dropdown dropdown-end">
          <label tabindex="0" class="btn btn-ghost btn-circle avatar">
            <div class="w-8 rounded-full">
              <img [src]="user?.avatarURL" alt="User Avatar" />
            </div>
          </label>
          <ul
            tabindex="0"
            class="mt-3 z-[1] p-2 shadow menu menu-sm dropdown-content bg-base-100 rounded-box w-52"
          >
            <li><a>Profile</a></li>
            <li><a>Settings</a></li>
            <li><a (click)="logout()">Logout</a></li>
          </ul>
        </div>
      </div>
    </header>

    <router-outlet></router-outlet>
    }
  </main>
</div>
